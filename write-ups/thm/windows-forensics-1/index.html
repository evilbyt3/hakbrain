<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Forensic Artifacts: are essential pieces of information that provide evidence of human activity (e.g during the investigation of a crime scene: fingerprints, tools used to perform the crime, etc are all considered forensic artifacts)."><title>Windows Forensics 1</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://hakbrain.xyz//icon.png><link href=https://hakbrain.xyz/styles.f40f9c8ac1c106641723dab5233fc67c.min.css rel=stylesheet><link href=https://hakbrain.xyz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://hakbrain.xyz/js/darkmode.8bfc78cc60cc5da6df81ec79c82c3775.min.js></script>
<script src=https://hakbrain.xyz/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://hakbrain.xyz/js/popover.abe6a51cc7138c5dff00f151dd627ad1.min.js></script>
<script src=https://hakbrain.xyz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://hakbrain.xyz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://hakbrain.xyz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://hakbrain.xyz/",fetchData=Promise.all([fetch("https://hakbrain.xyz/indices/linkIndex.1ac0c85aa1d684a4101724d7a8dc7d65.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://hakbrain.xyz/indices/contentIndex.d72768815c3e27fe4b3137779d455392.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://hakbrain.xyz",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://hakbrain.xyz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/hakbrain.xyz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://hakbrain.xyz/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://hakbrain.xyz/>üï∏Ô∏è H@kBr4in</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Windows Forensics 1</h1><p class=meta>Last updated
Dec 9, 2022
<a href=https://github.com/vlagh3/hakbrain/tree/hugo/content/write-ups/thm/windows-forensics-1.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://hakbrain.xyz/tags/writeups/>Writeups</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#windows-registry>Windows Registry</a><ol><li><a href=#structure>Structure</a></li><li><a href=#accessing-hives-offline>Accessing hives offline</a></li><li><a href=#transaction-logs--backups>Transaction Logs & Backups</a></li></ol></li><li><a href=#data-acquisition>Data Acquisition</a></li><li><a href=#system-information--accounts>System Information & Accounts</a></li><li><a href=#usage-of-filesfolders>Usage of files/folders</a></li><li><a href=#evidence-of-execution>Evidence of Execution</a></li><li><a href=#external-devices>External Devices</a></li><li><a href=#hands-on-challenge>Hands-On Challenge</a></li><li><a href=#references>References</a></li><li><a href=#see-also>See Also</a></li></ol></nav></details></aside><ul><li><strong>Forensic Artifacts</strong>: are essential pieces of information that provide evidence of human activity <em>(e.g during the investigation of a crime scene: fingerprints, tools used to perform the crime, etc are all considered forensic artifacts)</em>. Basically all the artifacts are combined to recreate the story of how the crime was committed. In the digital world, artifacts can be small footprints of activity left on the computer system</li></ul><a href=#windows-registry><h2 id=windows-registry><span class=hanchor arialabel=Anchor># </span>Windows Registry</h2></a><ul><li>A a collection of databases that contains the system&rsquo;s configuration data about the hardware, software, user&rsquo;s information <em>(e.g recently used files, programs used, devices connected)</em></li><li>It consists of Keys and Values</li><li>A¬†[Registry Hive](
<a href="https://docs.microsoft.com/en-us/windows/win32/sysinfo/registry-hives#:~:text=Registry" rel=noopener>https://docs.microsoft.com/en-us/windows/win32/sysinfo/registry-hives#:~:text=Registry</a> Hives. A hive is a logical group,with a separate file for the user profile.)¬†is a group of Keys, subkeys, and values stored in a single file on the disk</li><li>more about it on the
<a href=https://docs.microsoft.com/en-US/troubleshoot/windows-server/performance/windows-registry-advanced-users rel=noopener>official doc</a></li></ul><a href=#structure><h3 id=structure><span class=hanchor arialabel=Anchor># </span>Structure</h3></a><table><thead><tr><th>Folder/predefined Key</th><th>Description</th></tr></thead><tbody><tr><td><code>HKEY_CURRENT_USER</code></td><td>Contains the root of the configuration information for the user who is currently logged on. The user&rsquo;s folders, screen colors, and Control Panel settings are stored here. This information is associated with the user&rsquo;s profile. This key is sometimes abbreviated as HKCU.</td></tr><tr><td><code>HKEY_USERS</code></td><td>Contains all the actively loaded user profiles on the computer. <code>HKEY_CURRENT_USER</code> is a subkey of <code>HKEY_USERS</code>. <code>HKEY_USERS</code> is sometimes abbreviated as HKU.</td></tr><tr><td><code>HKEY_LOCAL_MACHINE</code></td><td>Contains configuration information particular to the computer (for any user). This key is sometimes abbreviated as HKLM.</td></tr><tr><td><code>HKEY_CLASSES_ROOT</code></td><td>Is a subkey of¬†<code>HKEY_LOCAL_MACHINE\Software</code>. The information that is stored here makes sure that the correct program opens when you open a file by using Windows Explorer. This key is sometimes abbreviated as HKCR.</td></tr><tr><td><code>HKEY_CURRENT_CONFIG</code></td><td>Contains information about the hardware profile that is used by the local computer at system startup.</td></tr></tbody></table><a href=#accessing-hives-offline><h3 id=accessing-hives-offline><span class=hanchor arialabel=Anchor># </span>Accessing hives offline</h3></a><p>If you only have access to a disk image, you must know where the registry hives are located on the disk. The majority of these hives are located in the¬†<code>C:\Windows\System32\Config</code>¬†directory and are:</p><ul><li><strong>DEFAULT</strong>: <code>HKEY_USERS\DEFAULT</code></li><li><strong>SAM</strong>: <code>HKEY_LOCAL_MACHINE\SAM</code></li><li><strong>SECURITY</strong>: <code>HKEY_LOCAL_MACHINE\Security</code></li><li><strong>SOFTWARE</strong>: <code>HKEY_LOCAL_MACHINE\Software</code></li><li><strong>SYSTEM</strong>: <code>HKEY_LOCAL_MACHINE\System</code></li></ul><p>Apart from these hives, two other hives containing user information can be found in the User profile directory <em>(<code>C:\Users\&lt;username></code>)</em>:</p><ul><li><code>NTUSER.dat</code> <em>(mounted on <code>HKEY_CURRENT_USER</code> upon login)</em></li><li><code>USRCLASS.dat</code> <em>(mounted on <code>HKEY_CURRENT_USER\Software\CLASSES</code>)</em></li></ul><blockquote><p><strong>NOTE</strong>: These are hidden files</p></blockquote><p>There&rsquo;s also another hive called <strong>AmCache</strong> located in <code>C:\Windows\AppCompat\Programs\Amcache.hve</code>. Windows creates it to save information on programs that were recemtly run on the system</p><a href=#transaction-logs--backups><h3 id=transaction-logs--backups><span class=hanchor arialabel=Anchor># </span>Transaction Logs & Backups</h3></a><p>¬†The transaction logs can be considered as the journal of the changelog of the registry hive. This means that thee logs can often have the latest changes in the registry that haven&rsquo;t made their way to the registry hives themselves.</p><p>They&rsquo;re stored aas a <code>.LOG</code> file in the same directory as the hive itself <em>(e.g for the SAM hive will be located in¬†<code>C:\Windows\System32\Config</code>¬†in the filename <code>SAM.LOG</code>)</em></p><p>Registry backups are the opposite of Transaction logs. These are the backups of the registry hives located in the¬†<code>C:\Windows\System32\Config</code>¬†directory. These hives are copied to the¬†<code>C:\Windows\System32\Config\RegBack</code>¬†directory every ten days</p><a href=#data-acquisition><h2 id=data-acquisition><span class=hanchor arialabel=Anchor># </span>Data Acquisition</h2></a><p>For the sake of accuracy, it is recommended practice to image the system or make a copy of the required data and perform forensics on it. This is called data acquisition.</p><p>When we go to copy the registry hives from¬†<code>%WINDIR%\System32\Config</code>, we cannot because it is a restricted file. For that we can use some tools:</p><ul><li><a href=https://www.kroll.com/en/services/cyber-risk/incident-response-litigation-support/kroll-artifact-parser-extractor-kape rel=noopener>Kape</a>: is a live data acquisition and analysis tool which can be used to acquire registry data</li><li><a href=https://www.autopsy.com/ rel=noopener>Autopsy</a>: gives you the option to acquire data from both live systems or from a disk image</li><li><a href=https://www.exterro.com/ftk-imager rel=noopener>FTK Imager</a>: similar to Autopsy and allows you to extract files from a disk image or a live system by mounting the said disk image or drive in FTK Imager</li><li><a href=https://accessdata.com/product-download/registry-viewer-2-0-0 rel=noopener>AccessData&rsquo;s Registry Viewer</a>: let&rsquo;s you explore the regitry similar to Windows Registry Editor <em>(only loads one hive at a time, and it can&rsquo;t take the transaction logs into account)</em></li><li><a href=https://ericzimmerman.github.io/#!index rel=noopener>Eric Zimmerman&rsquo;s Tools</a>: handful of¬†tools¬†that are very useful for performing Digital Forensics and Incident Response</li><li><a href=https://github.com/keydet89/RegRipper3.0 rel=noopener>RegRipper</a>: utility that takes a registry hive as input and outputs a report that extracts data from some of the forensically important keys and values in that hive</li></ul><a href=#system-information--accounts><h2 id=system-information--accounts><span class=hanchor arialabel=Anchor># </span>System Information & Accounts</h2></a><ul><li>to find the OS version check the <code>SOFTWARE\Microsoft\Windows NT\CurrentVersion</code><ul><li><img src="/write-ups/images/Pasted image 20220621200246.png" width=auto></li></ul></li><li>the hives containing the machine‚Äôs configuration data used for controlling system startup are called Control Sets. Commonly there&rsquo;s 2:<ul><li>ControlSet001: will point to the Control Set that the machine booted with <em>(@ <code>SYSTEM\ControlSet001</code>)</em></li><li>ControlSet002: will be the¬†last known good¬†configuration <em>(@ <code>SYSTEM\ControlSet002</code>)</em></li></ul></li><li>Windows creates a volatile Control Set when the machine is live, called the CurrentControlSet¬†(<code>HKLM\SYSTEM\CurrentControlSet</code>). To find out which Control et is being used a the CurrentControlSet we can look @ <code>SYSTEM/Select/Current</code>. Similary the last known good config can be found @ <code>SYSTEM/Select/LastKnownGood</code></li><li>find the Computer Name from: <code>SYSTEM\CurrentControlSet\Control\ComputerName\ComputerName</code></li><li>it&rsquo;s important to establish the time zone of the computer to better understand the chronology of events. It can be found @ <code>SYSTEM\CurrentControlSet\Control\TimeZoneInformation</code></li><li><strong>Network Interfaces & Past Networks</strong><ul><li>the following registry key will give a list of network interfaces on the machine we are investigating: <code>SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces</code></li><li><img src="/write-ups/images/Pasted image 20220621201045.png" width=auto></li><li>each Interface is represented with a unique identifier (GUID) subkey, which contains values relating to the interface‚Äôs TCP/IP configuration. Will provide us with info like IP address, DHCP, Subnet Masks, DNS, etc</li><li>the past networks a given machine was connected to can be found in the following locations: <code>SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Unmanaged</code> & <code>SOFTWARE\Microsoft\Windows NT\CurrentVersion\NetworkList\Signatures\Managed</code></li><li>the last write time of the registry key points to the last time these networks were connected.</li></ul></li><li><strong>Autoruns</strong><ul><li>include information about programs or commands that run when a user logs on<ul><li><p><code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Run</code></p></li><li><p><code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\RunOnce</code></p></li><li><p><code>SOFTWARE\Microsoft\Windows\CurrentVersion\RunOnce</code></p></li><li><p><code>SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer\Run</code></p></li><li><p><code>SOFTWARE\Microsoft\Windows\CurrentVersion\Run</code></p></li></ul></li><li>information about services: <code>SYSTEM\CurrentControlSet\Services</code><ul><li><img src="/write-ups/images/Pasted image 20220621201358.png" width=auto></li><li>if <code>start</code> is set to <code>0x02</code> => service will start on boot</li></ul></li></ul></li><li><strong>SAM hive and user information</strong>: SAM hive contains user account information, login information, and group information & is mainly located @ <code>SAM\Domains\Account\Users</code></li></ul><a href=#usage-of-filesfolders><h2 id=usage-of-filesfolders><span class=hanchor arialabel=Anchor># </span>Usage of files/folders</h2></a><ul><li><strong>Recent Files</strong>: Windows maintains a list of recently opened files for each user. This info is stored in the <code>NTUSER</code> hive @ <code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs</code><ul><li><img src="/write-ups/images/Pasted image 20220621201742.png" width=auto></li><li>if we&rsquo;re looking for a specific extenstion <em>(e.g <code>.pdf</code>)</em> we can check the following reg key: <code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs\.pdf</code></li></ul></li><li><strong>Office Recent Files</strong>: Microsoft Office also maintains a list of recently opened documents @ <code>NTUSER.DAT\Software\Microsoft\Office\VERSION</code><ul><li>version number for each Microsoft Office release is different <em>(e.g <code>NTUSER.DAT\Software\Microsoft\Office\15.0\Word</code>)</em></li><li>Starting from Office 365, Microsoft now ties the location to the user&rsquo;s¬†
<a href=https://www.microsoft.com/security/blog/2008/05/07/what-is-a-windows-live-id/ rel=noopener>live ID</a>: <code>NTUSER.DAT\Software\Microsoft\Office\VERSION\UserMRU\LiveID_####\FileMRU</code></li></ul></li><li><strong>ShellBags</strong>: When any user opens a folder, it opens in a specific layout, users can change this to their preferences. Layouts can be different for different folders. This info about the WIndows <em>shell</em> is stored & can identify the most recently used files/folders. Since this setting is different 4 each usser it&rsquo;s located in the user hives<ul><li><code>USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\Bags</code></li><li><code>USRCLASS.DAT\Local Settings\Software\Microsoft\Windows\Shell\BagMRU</code></li><li><code>NTUSER.DAT\Software\Microsoft\Windows\Shell\BagMRU</code></li><li><code>NTUSER.DAT\Software\Microsoft\Windows\Shell\Bags</code></li><li>we can use the
<a href=https://ericzimmerman.github.io/#!index rel=noopener>ShellBag Explorer from Zimmerman</a></li><li><img src="/write-ups/images/Pasted image 20220621204106.png" width=auto></li></ul></li><li><strong>Open/Save and LastVisited Dialog MRUs</strong>: When we open or save a file, a dialog box appears asking us where to save or open that file from, Windows remembering that location => we can find out recently used files if we get our hands on this information<ul><li><code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\OpenSavePIDlMRU</code></li><li><code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\ComDlg32\LastVisitedPidlMRU</code></li></ul></li><li><strong>Windows Explorer Address/Search Bars</strong>: to identify a user&rsquo;s recent activity is by looking at the paths typed in the Windows Explorer address bar or searches performed using the following registry keys, respectively:<ul><li><code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\TypedPaths</code></li><li><code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\WordWheelQuery</code></li></ul></li></ul><a href=#evidence-of-execution><h2 id=evidence-of-execution><span class=hanchor arialabel=Anchor># </span>Evidence of Execution</h2></a><ul><li><strong>UserAssist</strong>: Windows keeps track of applications launched by the user using Windows Explorer for statistical purposes in the User Assist registry keys<ul><li>contain info about the programs launched, the time of their launch, and the number of times they were executed</li><li>programs that were run using the command line can&rsquo;t be found in the User Assist keys</li><li>he User Assist key is present in the NTUSER hive, mapped to each user&rsquo;s GUID, we can find it @ <code>NTUSER.DAT\Software\Microsoft\Windows\Currentversion\Explorer\UserAssist\{GUID}\Count</code></li><li><img src="/write-ups/images/Pasted image 20220621204651.png" width=auto></li></ul></li><li><strong>ShimCache</strong>: is a mechanism used to keep track of application compatibility with the¬†OS¬†and tracks all applications¬†launched on the machine<ul><li>main purpose in Windows is to ensure backward compatibility of applications</li><li>also called Application Compatibility Cache (AppCompatCache) & found @ <code>SYSTEM\CurrentControlSet\Control\Session Manager\AppCompatCache</code></li><li>stores file name, file size, and last modified time of the executables</li><li>use <code>AppCompatCache Parser</code> tool to output a CSV: <code>AppCompatCacheParser.exe --csv &lt;path to save output> -f &lt;path to SYSTEM hive for data parsing> -c &lt;control set to parse></code><ul><li><img src="/write-ups/images/Pasted image 20220621204814.png" width=auto></li></ul></li></ul></li><li><strong>AmCache</strong>: AmCache hive is an artifact related to ShimCache<ul><li>performs a similar function to ShimCache, and stores additional data related to program executions <em>(e.g execution path, installation, execution and deletion times, and SHA1 hashes)</em></li><li>located in the file system @: <code>C:\Windows\appcompat\Programs\Amcache.hve</code></li><li>info about the last executed programs can be found @ <code>Amcache.hve\Root\File\{Volume GUID}\</code></li><li><img src="/write-ups/images/Pasted image 20220621205001.png" width=auto></li></ul></li><li><strong>BAM/DAM</strong>: Background Activity Monitor <em>(BAM)</em> keeps a tab on the activity of background applications. Similar Desktop Activity Moderator <em>(DAM)</em> is a part of Microsoft Windows that optimizes the power consumption of the device<ul><li>contain data about last run programs, their full paths & last execution time @</li><li><code>SYSTEM\CurrentControlSet\Services\bam\UserSettings\{SID}</code></li><li><code>SYSTEM\CurrentControlSet\Services\dam\UserSettings\{SID}</code></li><li><img src="/write-ups/images/Pasted image 20220621205142.png" width=auto></li></ul></li></ul><a href=#external-devices><h2 id=external-devices><span class=hanchor arialabel=Anchor># </span>External Devices</h2></a><ul><li><strong>Device identification</strong>: the following locations keep track of USB keys plugged into a system<ul><li><code>SYSTEM\CurrentControlSet\Enum\USBSTOR</code> & <code>SYSTEM\CurrentControlSet\Enum\USB</code></li><li>store data such as: vendor id, product id, and version of the USB device plugged in <em>(can be used to identify unique devices)</em></li><li><img src="/write-ups/images/Pasted image 20220621205416.png" width=auto></li></ul></li><li><strong>First/Last Times</strong>: the following registry key tracks the first time the device was connected, the last time it was connected and the last time the device was removed from the system<ul><li><code>SYSTEM\CurrentControlSet\Enum\USBSTOR\Ven_Prod_Version\USBSerial#\Properties\{83da6326-97a6-4088-9453-a19231573b29}\####</code></li><li>the <code>####</code> can be replaced with the following digits<ul><li><img src="/write-ups/images/Pasted image 20220621205520.png" width=auto></li></ul></li></ul></li><li><strong>USB Device Volume Name</strong>: device name of the connected drive can be found at the following location: <code>SOFTWARE\Microsoft\Windows Portable Devices\Devices</code><ul><li><img src="/write-ups/images/Pasted image 20220621205611.png" width=auto></li></ul></li></ul><a href=#hands-on-challenge><h2 id=hands-on-challenge><span class=hanchor arialabel=Anchor># </span>Hands-On Challenge</h2></a><p><strong>Scenario</strong>: One of the Desktops in the research lab at Organization X is suspected to have been accessed by someone unauthorized. Although they generally have only one user account per Desktop, there were multiple user accounts observed on this system. It is also suspected that the system was connected to some network drive, and a USB device was connected to the system. The triage data from the system was collected and placed on the attached¬†VM. Can you help Organization X with finding answers to the below questions?</p><ul><li>How many user created accounts are present on the system?<ul><li>open the <code>SAM</code> hive @ <code>C:\Users\THM-4n6\Desktop\triage\C\Windows\System32\config\SAM</code> w regitry explorer</li><li>HINT: accounts with RIDs starting with 10xx are user created accounts</li><li><img src="/write-ups/images/Pasted image 20220621214753.png" width=auto></li><li>so we have 3: <code>THM-4n6</code>, <code>thm-user</code>, <code>thm-user2</code></li></ul></li><li>What is the username of the account that has never been logged in?<ul><li>by looking @ the <code>Last Login Time</code> column we see that <code>thm-user2</code> never logged in</li><li><img src="/write-ups/images/Pasted image 20220621215045.png" width=auto></li></ul></li><li>What&rsquo;s the password hint for the user THM-4n6?<ul><li><img src="/write-ups/images/Pasted image 20220621215116.png" width=auto></li><li><code>count</code></li></ul></li><li>When was the file &lsquo;Changelog.txt&rsquo; accessed?<ul><li>open the <code>NTUSER.dat</code> from <code>C:\Users\THM-4n6\Desktop\triage\C\Users\THM-4n6</code></li><li>you will be alerted about a dirty hive, just load the <code>.LOG1 & 2</code> files to generate a clean one</li><li>then navigate to <code>NTUSER.DAT\Software\Microsoft\Windows\CurrentVersion\Explorer\RecentDocs</code></li><li><img src="/write-ups/images/Pasted image 20220621215459.png" width=auto></li></ul></li><li>What is the complete path from where the python 3.8.2 installer was run?<ul><li>navigate to the UserAssist <code>NTUSER.DAT\Software\Microsoft\Windows\Currentversion\Explorer\UserAssist\{GUID}\Count</code> & search for <code>python</code></li><li><img src="/write-ups/images/Pasted image 20220621215906.png" width=auto></li></ul></li><li>When was the USB device with the friendly name &lsquo;USB&rsquo; last connected?<ul><li>open the <code>C:\Users\THM-4n6\Desktop\triage\C\Windows\System32\config\SYSTEM</code> hive <em>(do the same with the <code>.LOG</code> files)</em></li><li>navigate to <code>SYSTEM\CurrentControlSet\Enum\USBSTOR</code> to see when the devices were first installed & last connected</li><li><img src="/write-ups/images/Pasted image 20220621220850.png" width=auto></li></ul></li></ul><hr><a href=#references><h2 id=references><span class=hanchor arialabel=Anchor># </span>References</h2></a><a href=#see-also><h2 id=see-also><span class=hanchor arialabel=Anchor># </span>See Also</h2></a><ul><li><a href=/write-ups/THM rel=noopener class=internal-link data-src=/write-ups/THM>write-ups/THM</a></li><li><a href=/write-ups/thm/windows-forensics-2 rel=noopener class=internal-link data-src=/write-ups/thm/windows-forensics-2>write-ups/thm/windows-forensics-2</a></li></ul></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/sheets/DFIR/ data-ctx=write-ups/thm/windows-forensics-1 data-src=/sheets/DFIR class=internal-link>DFIR</a></li><li><a href=/write-ups/thm/Cyber-Defense/ data-ctx=write-ups/thm/windows-forensics-1 data-src=/write-ups/thm/Cyber-Defense class=internal-link>Cyber Defense</a></li><li><a href=/write-ups/thm/SOC-Level-1-Path/ data-ctx=write-ups/thm/windows-forensics-1 data-src=/write-ups/thm/SOC-Level-1-Path class=internal-link>SOC Level 1 Path</a></li><li><a href=/write-ups/thm/windows-forensics-2/ data-ctx=write-ups/thm/windows-forensics-1 data-src=/write-ups/thm/windows-forensics-2 class=internal-link>Windows Forensics 2</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://hakbrain.xyz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Vl@gh3 using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, ¬© 2023</p><ul><li><a href=https://hakbrain.xyz/>Home</a></li><li><a href=https://twitter.com/vlaghe1>Twitter</a></li><li><a href=https://github.com/vlagh3>Github</a></li></ul></footer></div></div></body></html>