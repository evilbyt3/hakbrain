<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Story After investigating the web camera implant through hardware and firmware reverse engineering, you are tasked with identifying and exploiting any known vulnerabilities in the web camera."><title>21 MQTT - Have yourself a merry little webcam</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://hakbrain.xyz//icon.png><link href=https://hakbrain.xyz/styles.f40f9c8ac1c106641723dab5233fc67c.min.css rel=stylesheet><link href=https://hakbrain.xyz/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://hakbrain.xyz/js/darkmode.8bfc78cc60cc5da6df81ec79c82c3775.min.js></script>
<script src=https://hakbrain.xyz/js/util.9825137f5e7825e8553c68ce39ac9e44.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://hakbrain.xyz/js/popover.abe6a51cc7138c5dff00f151dd627ad1.min.js></script>
<script src=https://hakbrain.xyz/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://hakbrain.xyz/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://hakbrain.xyz/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const BASE_URL="https://hakbrain.xyz/",fetchData=Promise.all([fetch("https://hakbrain.xyz/indices/linkIndex.1ac0c85aa1d684a4101724d7a8dc7d65.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://hakbrain.xyz/indices/contentIndex.d72768815c3e27fe4b3137779d455392.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://hakbrain.xyz",!0,!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://hakbrain.xyz",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/hakbrain.xyz\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://hakbrain.xyz/js/full-text-search.24827f874defbbc6d529926cbfcfb493.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://hakbrain.xyz/>üï∏Ô∏è H@kBr4in</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>21 MQTT - Have yourself a merry little webcam</h1><p class=meta>Last updated
Dec 22, 2022
<a href=https://github.com/vlagh3/hakbrain/tree/hugo/content/write-ups/thm/21%20MQTT%20-%20Have%20yourself%20a%20merry%20little%20webcam.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://hakbrain.xyz/tags/writeups/>Writeups</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#story>Story</a><ol><li><a href=#learning-objectives>Learning Objectives</a></li></ol></li><li><a href=#notes>Notes</a><ol><li><a href=#internet-of-things-iot>Internet of Things <em>(IoT)</em></a></li></ol></li><li><a href=#practical>Practical</a></li><li><a href=#refs>Refs</a></li><li><a href=#see-also>See Also</a></li></ol></nav></details></aside><a href=#story><h2 id=story><span class=hanchor arialabel=Anchor># </span>Story</h2></a><p>After investigating the web camera implant through hardware and firmware reverse engineering, you are tasked with identifying and exploiting any known vulnerabilities in the web camera. Elf Mcskidy is confident you won&rsquo;t be able to compromise the web camera as it seems to be up-to-date, but we will investigate if off-the-shelf exploits are even needed to take back control of the workshop.</p><a href=#learning-objectives><h3 id=learning-objectives><span class=hanchor arialabel=Anchor># </span>Learning Objectives</h3></a><ul><li>Explain the Internet of Things, why it is important, and if we should be concerned about their danger.</li><li>Understand the difference between an IoT-specific protocol and other network service protocols.</li><li>Understand what a publish/subscribe model is and how it interacts with IoT devices.</li><li>Analyze and exploit the behavior of a vulnerable IoT device.</li></ul><a href=#notes><h2 id=notes><span class=hanchor arialabel=Anchor># </span>Notes</h2></a><a href=#internet-of-things-iot><h3 id=internet-of-things-iot><span class=hanchor arialabel=Anchor># </span>Internet of Things <em>(IoT)</em></h3></a><p>Defines a categorization of just that, <em>&ldquo;things&rdquo;</em>: the term can be used broadly as <em>&ldquo;a device that sends and receives data to communicate with other devices and systems&rdquo;</em> <em>(e.g thermostats, web cameras, smart fridges, smart locks)</em></p><p><strong>What makes them important or warrants that we study them?</strong></p><ol><li>IoT devices tend to be lightweight => functionality and features are limited to only essentials. Because of that modern features may be left out or overlooked, one of the most concerning being security</li><li>are interconnected and often involve no human interaction => designed to communicate data effectively but also negotiate a secure means of communication</li><li>designed to all be interconnected: if device $A$ is using $x$ protocol & device $B$ uses $y$ protocol there might be compatibility issues. In the case of security, devices which are incompatible could fall back to insecure communication</li></ol><a href=#protocols><h4 id=protocols><span class=hanchor arialabel=Anchor># </span>Protocols</h4></a><p>Any protocol used by an IoT device for¬†machine-to-machine,¬†machine-to-gateway, or¬†machine-to-cloud¬†communication. Its objective is to provide efficient, reliable & secure data communication. Break up into 2 types:</p><ol><li><strong>IoT data protocol</strong>: relies on the <a class="internal-link broken">TCP/IP Model</a> <em>(<a class="internal-link broken">HTTP</a> can be used as the backbone)</em></li><li><strong>IoT network protocol</strong>: relies on wireless technology - rather tahn relying on traditional TCP, it uses WiFi, Bluetooth, ZigBee & Z-Wave to transfer data between entities</li></ol><p><img src="/write-ups/images/Pasted image 20221222191602.png" width=auto></p><table><thead><tr><th>Protocol</th><th>Comm Method</th><th>Description</th></tr></thead><tbody><tr><td>MQTT - Message Queuing Telemetry Transport</td><td>Middleware</td><td>lightweight, relies on publish/subscribe model to send & rcv msgs</td></tr><tr><td>CoAP - Contrained Application Protocol</td><td>Middleware</td><td>translates <a class="internal-link broken">HTTP</a> comms to a usable comm medium 4 devices</td></tr><tr><td>AMQP - Advanced Messaging Queuing</td><td>Middleware</td><td>acts as a transactional protocol to receive, queue & store msgs/payloads between devices</td></tr><tr><td>DDS - Data Distribution Service</td><td>Middleware</td><td>scalable, it relieves on a publish/subscribe model</td></tr><tr><td><a class="internal-link broken">HTTP</a></td><td>Device 2 Device</td><td>all know about it</td></tr><tr><td>WebSocket</td><td>Device 2 Device</td><td>client-server model over <a class="internal-link broken">TCP</a></td></tr></tbody></table><a href=#publish--subscribe-model><h4 id=publish--subscribe-model><span class=hanchor arialabel=Anchor># </span>Publish / Subscribe Model</h4></a><p><img src="/write-ups/images/Pasted image 20221222191649.png" width=auto></p><ol><li>publisher sends msg to broker</li><li>broker continues relaying the message until a new message is published</li><li>subscriber can attempt to connect to broker in order to recv msgs</li></ol><p>To ensure integrity <em>(one publisher should not overwrite another)</em>, a broker can store multiple messages from different publishers using <strong>topics</strong>:</p><ul><li>a semi-arbitrary value pre-negotiated by the publisher and subscriber and sent along with a message</li><li>commonly takes the form of <code>&lt;name>/&lt;id>/&lt;function></code></li></ul><p>2 publishers sending messages associated with topics:</p><p><img src="/write-ups/images/Pasted image 20221222192001.png" width=auto></p><p>several subscribers receiving msgs from separate topics</p><p><img src="/write-ups/images/Pasted image 20221222192008.png" width=auto></p><blockquote><p><strong>NOTE</strong>: the¬†<em>asynchronous</em>¬†nature of this communication; the publisher can publish at any time, and the subscriber can subscribe to a topic to see if the broker relaid message</p></blockquote><a href=#practical><h2 id=practical><span class=hanchor arialabel=Anchor># </span>Practical</h2></a><a href=#refs><h2 id=refs><span class=hanchor arialabel=Anchor># </span>Refs</h2></a><ul><li></li></ul><a href=#see-also><h2 id=see-also><span class=hanchor arialabel=Anchor># </span>See Also</h2></a><ul><li><a href=/write-ups/thm/Advent-of-Cyber-2022 rel=noopener class=internal-link data-src=/write-ups/thm/Advent-of-Cyber-2022>write-ups/thm/Advent of Cyber 2022</a></li><li><a href=/write-ups/thm/20-Firmware-Binwalkin-around-the-Christmas-tree rel=noopener class=internal-link data-src=/write-ups/thm/20-Firmware-Binwalkin-around-the-Christmas-tree>write-ups/thm/20 Firmware - Binwalkin around the Christmas tree</a> | <a href=/write-ups/thm/22-Attack-Surface-Reduction-Threats-are-failing-all-around-me rel=noopener class=internal-link data-src=/write-ups/thm/22-Attack-Surface-Reduction-Threats-are-failing-all-around-me>write-ups/thm/22 Attack Surface Reduction - Threats are failing all around me</a></li><li><a href=/sheets/RTSP-CCTV-Cam-Testing rel=noopener class=internal-link data-src=/sheets/RTSP-CCTV-Cam-Testing>sheets/RTSP CCTV Cam Testing</a></li></ul></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li><a href=/write-ups/thm/20-Firmware-Binwalkin-around-the-Christmas-tree/ data-ctx="write-ups/thm/21 MQTT - Have yourself a merry little webcam" data-src=/write-ups/thm/20-Firmware-Binwalkin-around-the-Christmas-tree class=internal-link>20 Firmware - Binwalkin around the Christmas tree</a></li><li><a href=/write-ups/thm/22-Attack-Surface-Reduction-Threats-are-failing-all-around-me/ data-ctx="write-ups/thm/21 MQTT - Have yourself a merry little webcam" data-src=/write-ups/thm/22-Attack-Surface-Reduction-Threats-are-failing-all-around-me class=internal-link>22 Attack Surface Reduction - Threats are failing all around me</a></li><li><a href=/write-ups/thm/Advent-of-Cyber-2022/ data-ctx="write-ups/thm/21 MQTT - Have yourself a merry little webcam" data-src=/write-ups/thm/Advent-of-Cyber-2022 class=internal-link>Advent of Cyber 2022</a></li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://hakbrain.xyz/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Vl@gh3 using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, ¬© 2023</p><ul><li><a href=https://hakbrain.xyz/>Home</a></li><li><a href=https://twitter.com/vlaghe1>Twitter</a></li><li><a href=https://github.com/vlagh3>Github</a></li></ul></footer></div></div></body></html>