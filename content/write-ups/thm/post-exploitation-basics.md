---
title: Post Exploitation Basics (Windows)
tags:
- writeups
---

## PowerView Enumeration
- start PS with bypass the exec policy *(allows to easily run scripts)*: `powershell -ep bypass`
- load PowerView: `. .\Downloads\PowerView.ps1`
- enumerate domain users: 
	- ![[write-ups/images/Pasted image 20220801141016.png]]
- enumerate domain groups: 
	- ![[write-ups/images/Pasted image 20220801141051.png]]
- get network shares & computer data:
	- ![[write-ups/images/Pasted image 20220801141454.png]]
- for more check out this [cheatsheet](https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993)

## BloodHound Mapping/Enumeration
[BloodHound](https://bloodhound.readthedocs.io/en/latest/index.html) allows to visually map out a Windows network. Along with [SharpHound](https://github.com/BloodHoundAD/SharpHound), similar to [PowerView](https://bloodhound.readthedocs.io/en/latest/data-collection/sharphound.html), it's a data collector to retrieve users, groups, trusts, etc & store them into a `.json` file

![[write-ups/images/Pasted image 20220801142132.png]]

> **NOTE**: I needed to downgrade to [BloodHound 3.0](https://github.com/BloodHoundAD/BloodHound/releases/tag/3.0.5) in order to import the `loot.zip` generated. That's because the VM on THM is using an older version of SharpHound (see [this issue](https://github.com/BloodHoundAD/BloodHound/issues/516)) 

Import the `loot.zip` into BloodHound & now we can explore the Windows infrastructure
![[write-ups/images/Pasted image 20220801144554.png]]
- we have pre-build queries @ our disposal. We can do things like `shortest path to domin admin`
	- ![[write-ups/images/Pasted image 20220801144649.png]]

## Mimikatz dumping
![[write-ups/images/Pasted image 20220801144900.png]]

Crack `Machine1` password:
![[write-ups/images/Pasted image 20220801145144.png]]

### Golden Ticket Attack
- dump the hash and sid of the krbtgt user then create a golden ticket and use that golden ticket to open up a new command prompt allowing us to access any machine on the network
	- ![[write-ups/images/Pasted image 20220801150104.png]]
- create the golden ticket
	- ![[write-ups/images/Pasted image 20220801151001.png]]
- access any machine on the network !
	- `misc::cmd`: open a new shell with elevated privileges to all machines


## Enum w Server Manager
- connect to the machine: `xfreerdp /v:10.10.206.240 /u:Administrator`
- ![[write-ups/images/Pasted image 20220801151836.png]]
- under `Tools > Active Directory Users & Computers` will give us more info
	- ![[write-ups/images/Pasted image 20220801151917.png]]
- some sys admins don't realize that anyone else can be looking in the desscription of user accounts => we now have the SQLService password

## Refs
- [PowerSploit docs](https://powersploit.readthedocs.io/en/stable/Recon/README/)
- [https://blog.harmj0y.net/](https://blog.harmj0y.net/)[](https://blog.harmj0y.net/)
- [https://adsecurity.org/?page_id=1821](https://adsecurity.org/?page_id=1821)[](https://adsecurity.org/?page_id=1821)
- [https://metasploit.help.rapid7.com/docs/about-post-exploitation](https://metasploit.help.rapid7.com/docs/about-post-exploitation)  
- [http://www.pentest-standard.org/index.php/Post_Exploitation](http://www.pentest-standard.org/index.php/Post_Exploitation)
- [https://offsec.red/mimikatz-cheat-sheet/](https://offsec.red/mimikatz-cheat-sheet/)[](https://offsec.red/mimikatz-cheat-sheet/)
- [https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993](https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993)

## See Also
- [[write-ups/THM]]